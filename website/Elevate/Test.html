<style>
    .worldwide-offices-section>* {
        position: relative;
        z-index: 1;
    }

    .worldwide-offices-section {
        padding: 0 0 0% 0;
        position: relative;

        .section-header-container {
            text-align: left;
            margin-bottom: 1.68%;

            h2 {
                margin-bottom: 0;
            }
        }

        .worldwide-offices-section-inner {
            .owl-carousel {
                .owl-stage-outer {
                    padding-bottom: 4%;
                }

                .item {
                    align-content: center;
                    cursor: pointer;
                    min-height: clamp(4.5rem, 1.495rem + 3.756vw, 6rem);
                    position: relative;
                    color: rgba(255, 255, 255, 0.5);
                    transition: transform 0.3s ease, color 0.3s ease;
                }

                .item::after {
                    content: "";
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    width: 100%;
                    height: 2px;
                    background-color: rgba(255, 255, 255, 0.5);
                    z-index: 1;
                }

                .item::before {
                    content: "";
                    position: absolute;
                    bottom: 0;
                    left: 0;
                    width: 0;
                    height: 2px;
                    background-color: white;
                    z-index: 1;
                    transition: width 0.3s ease;
                }

                .item:hover:before,
                .item.current:before {
                    width: 100%;
                }

                .item:hover,
                .item.current {
                    color: #fff;
                }
            }

            .content-box {
                padding: 0 3.34%;
                opacity: 0;
                transform: translateY(20%);
                transition: opacity 0.3s ease, transform 0.3s ease;

                .service-btn-solid {
                    min-width: 176px;
                    height: 48px;
                    padding: 0;
                    background-color: var(--adro-electric-blue);
                }

                .service-btn-solid:hover {
                    background-color: var(--ia-btn-hover-color);
                }

                .portrait-only-box {
                    display: none;
                }

                .office-list {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 1.79%;
                }

                .office-card {
                    position: relative;
                    width: 32.14%;
                    box-sizing: border-box;
                    display: flex;
                    flex-direction: column;
                    margin-bottom: 5.3%;
                }

                .office-image {
                    position: relative;
                    width: 100%;
                    aspect-ratio: 72 / 43;
                    border-radius: 20px;
                }

                .office-city {
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%,
                            -50%);
                    /* Center the text horizontally and vertically */
                    text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7);
                    /* Optional for better visibility */
                    text-align: center;
                    z-index: 1;
                }

                .office-details {
                    width: 81.3%;
                    margin-top: 2.8%;
                }

                .office-country {
                    color: var(--adro-yellow);
                }

                .office-address {
                    margin: 3.5% 0;
                }

                .office-phone {}
            }

            @media screen and (min-width: 768px) and (max-width: 1024px) and (orientation: landscape) {
                margin-bottom: 5%;
            }

            @media screen and (min-width: 768px) and (max-width: 1024px) and (orientation: portrait),
            screen and (max-width: 767.5px) {}

            .fade-up {
                opacity: 1;
                transform: translateY(0);
            }

            .content-box {
                .office-details {
                    width: 100%;
                }
            }
        }

        @media screen and (min-width: 768px) and (max-width: 1024px) and (orientation: portrait) {
            padding: 0% 0 4.8%;

            .section-header-container {
                margin-bottom: 5.3%;
            }

            .worldwide-offices-section-inner {
                .owl-carousel {
                    .owl-stage-outer {
                        padding-bottom: 6.85%;
                    }
                }

                .content-box {
                    padding: 0 4.8%;

                    .office-list {
                        gap: 5.03%;
                    }

                    .office-card {
                        width: 29.98%;
                        margin-bottom: 4.8%;
                    }

                    .office-details {
                        margin-top: 7.1%;
                    }

                    .office-address {
                        margin: 7.2% 0;
                    }

                    .office-image {
                        aspect-ratio: 113/72;
                    }
                }
            }
        }

        @media (max-width: 767.5px) {
            padding: 0 0 12.4% 0;

            .section-header-container {
                padding: 0 6.2%;
                margin-bottom: 4.15%;
            }

            .worldwide-offices-section-inner {
                .owl-carousel {
                    .owl-stage-outer {
                        padding-bottom: 8.5%;
                    }

                    .item {
                        min-height: 3.5rem;
                    }
                }

                .content-box {
                    flex-direction: column;
                    margin-top: 0;
                    padding: 0 6.2%;

                    .office-list {
                        width: 100%;
                        gap: 3.4%;
                    }

                    .office-card {
                        width: 48.3%;
                        margin-bottom: 7.1%;
                    }

                    .office-image {
                        aspect-ratio: 165 / 104;
                    }

                    .office-details {
                        margin-top: 4.5%;
                    }

                    .office-address {
                        margin: 4.9% 0;
                    }
                }
            }
        }
    }
</style>
<script>
    jQuery(document).ready(function () {
        var worldwide_offices_owl = jQuery(
            ".worldwide-offices-section .owl-carousel"
        );
        function initializeOfferingsCarousel() {
            worldwide_offices_owl.owlCarousel({
                loop: false,
                nav: true,
                dots: false,
                items: 4,
                responsive: {
                    0: {
                        items: 1.5,
                        margin: 32,
                        stagePadding: 24,
                        nav: false,
                        dots: true,
                        loop: true,
                        dotsEach: 1,
                    },
                    435: {
                        margin: 32,
                        stagePadding: window.matchMedia("(orientation: portrait)").matches
                            ? 30
                            : 24,
                        items: 1.5,
                        nav: false,
                        dots: true,
                        loop: true,
                        dotsEach: 1,
                    },
                    500: {
                        margin: 31,
                        stagePadding: window.matchMedia("(orientation: portrait)").matches
                            ? 31
                            : 24,
                        items: 1.5,
                        nav: false,
                        dots: true,
                        loop: true,
                        dotsEach: 1,
                    },
                    768: {
                        items: window.matchMedia("(orientation: portrait)").matches
                            ? 2.19
                            : 4,
                        margin: 40,
                        stagePadding: 40,
                        nav: false,
                        dots: true,
                        loop: true,
                        dotsEach: 1,
                    },
                    770: {
                        margin: window.matchMedia("(orientation: portrait)").matches
                            ? 40
                            : 30,
                        stagePadding: window.matchMedia("(orientation: portrait)").matches
                            ? 40
                            : 30,
                        items: window.matchMedia("(orientation: portrait)").matches
                            ? 2.19
                            : 4,
                        nav: false,
                        dots: true,
                        dotsEach: 1,
                        loop: true,
                    },
                    1010: {
                        margin: window.matchMedia("(orientation: portrait)").matches
                            ? 40
                            : 60,
                        stagePadding: window.matchMedia("(orientation: portrait)").matches
                            ? 40
                            : 40,
                        items: window.matchMedia("(orientation: portrait)").matches
                            ? 2.19
                            : 4,
                        nav: false,
                        dots: true,
                        dotsEach: 1,
                        loop: true,
                    },
                    1025: {
                        margin: 76,
                        stagePadding: 40,
                    },
                    1300: {
                        margin: 150,
                        stagePadding: 45,
                    },
                    1440: {
                        margin: 180,
                        stagePadding: 55,
                    },
                    1650: {
                        margin: 192,
                        stagePadding: 64,
                    },
                },
            });
            updateActiveItem();
            detectUserContinentAndSetActive();
        }

        function updateActiveItem() {
            jQuery(".worldwide-offices-section .owl-carousel .owl-item .item")
                .removeClass("current small-size font-bold")
                .addClass("smaller-size");
            var newActiveItem = jQuery(
                ".worldwide-offices-section .owl-carousel .owl-item.active"
            )
                .first()
                .find(".item");
            newActiveItem
                .addClass("current small-size font-bold")
                .removeClass("smaller-size");
            updateContent(newActiveItem);
        }

        function updateContent(activeItem) {
            const region = activeItem.data("region");
            const officeListContainer = jQuery(
                ".worldwide-offices-section .content-box .office-list"
            );

            // Clear existing office cards
            officeListContainer.empty();

            // Get the region-specific office data
            const offices = officeData[region];

            if (offices) {
                offices.forEach(function (office) {
                    const officeCard = `
                <div class="office-card">
              <div style="background: linear-gradient(0deg, rgba(67, 102, 143, 0.14) 6.25%, rgba(5, 9, 14, 0.52) 74.78%), url(data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 5'%3E%3C/svg%3E) lightgray no-repeat; background-size: cover; background-position: center;" class="office-image manual-lazy-load"  data-src="${office.officePhoto}">
                <div class="office-city medium-size font-bold">${office.officeCity}</div>
                </div>
                  <div class="office-details">
                    <h3 class="office-country smallest-size">${office.officeCountry}</h3>
                    <p class="office-address smaller-size">${office.officeAddress}</p>
                    <p class="office-phone smaller-size">${office.officePhone}</p>
                  </div>
                </div>
              `;
                    officeListContainer.append(officeCard);
                });
            }
            jQuery(".worldwide-offices-section .content-box").removeClass("fade-up");
            jQuery(".worldwide-offices-section .content-box").addClass("fade-up");
        }
        // Function to detect user's continent and apply the "current" class


        function detectUserContinentAndSetActive() {
            try {
                const userContinent = window.geoData?.continent || 'Europe';
                const region = determineRegion(userContinent);
                const defaultRegion = "uk_europe";
                const targetRegion = region || defaultRegion;

                jQuery(".worldwide-offices-section .owl-carousel .item")
                    .removeClass("current small-size font-bold")
                    .addClass("smaller-size");

                const regionItem = jQuery(
                    `.worldwide-offices-section .owl-carousel .item[data-region="${targetRegion}"]`
                );

                regionItem
                    .addClass("current small-size font-bold")
                    .removeClass("smaller-size");

                updateContent(regionItem);
            } catch (error) {
                console.error("Error detecting user location:", error);

                const fallbackItem = jQuery(
                    ".worldwide-offices-section .owl-carousel .item[data-region='uk_europe']"
                );
                fallbackItem
                    .addClass("current small-size font-bold")
                    .removeClass("smaller-size");

                updateContent(fallbackItem);
            }
        }

        // Helper function to fallback
        function setDefaultRegion() {
            const defaultRegionItem = jQuery(
                ".worldwide-offices-section .owl-carousel .item[data-region='uk_europe']"
            );
            defaultRegionItem
                .addClass("current small-size font-bold")
                .removeClass("smaller-size");

            updateContent(defaultRegionItem);
        }


        // Function to map the continent to a region
        function determineRegion(continent) {
            const continentMapping = {
                Asia: "asia",
                Europe: "uk_europe",
                "North America": "north_america",
                "South America": "latin_america",
            };

            return continentMapping[continent] || "uk_europe";
        }

        function updateResponsiveSettings() {
            const isPortrait = window.matchMedia("(orientation: portrait)").matches;

            const newResponsive = {
                0: {
                    items: 1.5,
                    margin: 32,
                    stagePadding: 24,
                    nav: false,
                    loop: true,
                    dots: true,
                    dotsEach: 1,
                },
                435: {
                    margin: 32,
                    stagePadding: isPortrait ? 30 : 24,
                    items: 1.5,
                    nav: false,
                    dots: true,
                    loop: true,
                    dotsEach: 1,
                },
                500: {
                    margin: 32,
                    stagePadding: isPortrait ? 31 : 24,
                    items: 1.5,
                    nav: false,
                    dots: true,
                    loop: true,
                    dotsEach: 1,
                },
                768: {
                    items: isPortrait ? 2.19 : 4,
                    margin: 40,
                    stagePadding: 40,
                    nav: false,
                    dots: true,
                    dotsEach: 1,
                    loop: true,
                },
                770: {
                    margin: isPortrait ? 40 : 30,
                    stagePadding: isPortrait ? 40 : 30,
                    items: isPortrait ? 2.19 : 4,
                    nav: false,
                    dots: true,
                    dotsEach: 1,
                    loop: true,
                },
                1010: {
                    margin: isPortrait ? 40 : 60,
                    stagePadding: isPortrait ? 40 : 40,
                    items: isPortrait ? 2.19 : 4,
                    nav: false,
                    dots: true,
                    dotsEach: 1,
                    loop: true,
                },
                1025: {
                    margin: 76,
                    stagePadding: 40,
                },
                1300: {
                    margin: 150,
                    stagePadding: 45,
                },
                1440: {
                    margin: 180,
                    stagePadding: 55,
                },
                1650: {
                    margin: 192,
                    stagePadding: 64,
                },
            };

            jQuery(worldwide_offices_owl).trigger("refresh.owl.carousel");
            jQuery(worldwide_offices_owl).data("owl.carousel").options.responsive =
                newResponsive;
        }

        initializeOfferingsCarousel();

        jQuery(".worldwide-offices-section .owl-carousel .item").on(
            "click",
            function () {
                if (jQuery(this).hasClass("current")) return;
                jQuery(".worldwide-offices-section .owl-carousel .item")
                    .removeClass("current small-size font-bold")
                    .addClass("smaller-size");
                jQuery(this)
                    .addClass("current small-size font-bold")
                    .removeClass("smaller-size");

                updateContent(jQuery(this));

                var $carousel = jQuery(".worldwide-offices-section .owl-carousel");
                var $clickedItem = jQuery(this);
                var $nonClonedItems = $carousel.find(".owl-item:not(.cloned) .item");
                var index = $nonClonedItems.index($clickedItem);

                if (index === -1) {
                    // Handle cloned first item clicked (appears at the end due to loop)
                    var clonedIndex = $carousel.find(".owl-item .item").index($clickedItem);

                    // If it's the cloned version of the first slide
                    if ($clickedItem.attr("data-id") === "0" || clonedIndex >= $nonClonedItems.length) {
                        $carousel.trigger("to.owl.carousel", [0, 300, true]);
                    }
                } else {
                    // Regular case
                    $carousel.trigger("to.owl.carousel", [index, 300, true]);
                }

            }
        );

        worldwide_offices_owl.on("changed.owl.carousel", function () {
            setTimeout(updateActiveItem, 100);
        });

        let resizeTimeout;
        jQuery(window).on("resize", function () {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(updateResponsiveSettings, 300);
        });
    });
    document.addEventListener("DOMContentLoaded", function () {
        window.addEventListener("resize", moveNavButtons);
        setTimeout(function () {
            var worldwide_offices_carousel_controls = document.querySelector(
                ".worldwide-offices-section .owl-carousel .carousel-controls"
            );
            let playPauseBtn =
                worldwide_offices_carousel_controls.querySelector("#playPauseBtn");
            if (playPauseBtn) {
                playPauseBtn.remove();
            }
            moveNavButtons();
        }, 100);
        function moveNavButtons() {
            const contentBox = document.querySelector(
                ".worldwide-offices-section .content-box"
            );
            const owlNav = document.querySelector(
                ".worldwide-offices-section .carousel-controls"
            );

            if (window.innerWidth < 1025) {
                contentBox.after(owlNav);
            } else {
                setTimeout(function () {
                    const carouselWrapper = document.querySelector(
                        ".worldwide-offices-section .owl-carousel"
                    );
                    carouselWrapper.appendChild(owlNav);
                }, 100);
            }
        }
    });
</script>